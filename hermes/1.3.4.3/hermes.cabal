name:                hermes
version:             1.3.4.3
x-revision: 1
description:         -
license-file:        LICENSE
license:             OtherLicense
author:              -
maintainer:          -
category:            Web
build-type:          Simple
cabal-version:       >=1.14


data-files:
  test-avatars/cat.jpg
  test-attachments/test.pdf
  test-videos/testvideo
  test-videos/upsidedown
  test-videos/unsupported
  test-videos/junk
  resources/rabbitmqadmin.conf.template
  resources/index.m3u8.template
  resources/crossdomain.xml
  php/hermes.php
  hermes.cabal
  prod-eu.cfg
  prod-us.cfg
  prod-au.cfg
  devel.cfg
  devel-ec2.cfg
  stg.cfg

  snaplets/postgresql-simple/devel.cfg
  snaplets/postgresql-simple/devel-ec2.cfg
  snaplets/postgresql-simple/prod-eu.cfg
  snaplets/postgresql-simple/prod-us.cfg
  snaplets/postgresql-simple/prod-au.cfg
  snaplets/postgresql-simple/stg.cfg

  snaplets/hermes/devel.cfg
  snaplets/hermes/devel-ec2.cfg
  snaplets/hermes/prod-eu.cfg
  snaplets/hermes/prod-us.cfg
  snaplets/hermes/prod-au.cfg
  snaplets/hermes/stg.cfg

  provisioning/hosts
  provisioning/modules/get_asg_topology
  provisioning/modules/get_asg_topology_new
  provisioning/modules/get_lc_topology_new
  provisioning/modules/unify_ami
  provisioning/playbooks/ami_common.yml
  provisioning/playbooks/cleanup.yml
  provisioning/playbooks/copy_base_to_region.yml
  provisioning/playbooks/copy_configuration_files.yml
  provisioning/playbooks/deploy_dev.yml
  provisioning/playbooks/deploy_cluster.yml
  provisioning/playbooks/start_additional_server.yml
  provisioning/playbooks/deploy_server.yml
  provisioning/playbooks/deploy_stg.yml
  provisioning/playbooks/deploy_meter.yml
  provisioning/playbooks/deploy_lite.yml
  provisioning/playbooks/post_new_instance_server.yml
  provisioning/playbooks/install_hermes.yml
  provisioning/playbooks/install_software_deps.yml
  provisioning/playbooks/generate_hermes_snap_config.yml
  provisioning/playbooks/generate_systemd_services.yml
  provisioning/playbooks/templates/haproxy.cfg
  provisioning/playbooks/templates/datadog.conf
  provisioning/playbooks/templates/datadog-agent
  provisioning/playbooks/templates/etc/cron.hourly/hermes_collect_metrics.cron
  provisioning/playbooks/templates/etc/systemd/system/haproxy.service
  provisioning/playbooks/templates/etc/systemd/system/hermes.service
  provisioning/playbooks/templates/usr/bin/start_hermes
  provisioning/playbooks/templates/usr/bin/stop_hermes

  provisioning/playbooks/templates/hermes-server
  provisioning/playbooks/templates/htaccess_deny_all
  provisioning/playbooks/filter_plugins/hermes.py

flag hpc
  default: False

flag library-only
  default: False

flag release
  default: False

flag bench
  default: False

flag prof
  default: False

flag threadscope
  default: False

library
  hs-source-dirs:
     src

  default-language:
    Haskell2010


  if flag(prof)
    ghc-options: -fprof-auto -rtsopts -auto-all -caf-all

  if flag(threadscope)
    ghc-options: -threaded -eventlog

  exposed-modules:
    Data.Sequence.Circular
    Hermes
    Hermes.OS
    Hermes.Products
    Hermes.Types
    Hermes.Upload
    Hermes.CLI
    Hermes.Crypto
    Hermes.Provisioning
    Hermes.Error
    Hermes.Cloud
    Hermes.Utils
    Hermes.Config
    Hermes.Logger
    Hermes.Logger.Pretty
    Hermes.Metrics
    Hermes.Metrics.Query
    Hermes.Metrics.Types
    Hermes.Stats
    Hermes.Stats.Types
    Hermes.Stats.SQL
    Hermes.Stats.Query
    Hermes.Stats.Filter
    Hermes.Notify
    Hermes.Retry
    Hermes.Sem
    Hermes.MediaLifeCycle
    -- Backend stuff
    Hermes.Backend.Types
    Hermes.Backend.FFmpeg
    Hermes.Backend.FFmpeg.FastStart
    Hermes.Backend.FFmpeg.Audio
    Hermes.Backend.FFmpeg.Audio.Preset
    Hermes.Backend.FFmpeg.Clip
    Hermes.Backend.FFmpeg.CLI
    Hermes.Backend.FFmpeg.Probe
    Hermes.Backend.FFmpeg.Proxy
    Hermes.Backend.FFmpeg.Rotate
    Hermes.Backend.FFmpeg.Core
    Hermes.Backend.FFmpeg.Presets
    Hermes.Backend.FFmpeg.Filters
    Hermes.Backend.FFmpeg.Merge
    Hermes.Backend.FFmpeg.Thumbnails
    Hermes.Backend.FFmpeg.HLS
    Hermes.Backend.FFmpeg.HLS.Presets
    Hermes.Backend.ImageMagick
    Hermes.Backend.ImageMagick.Presets
    Hermes.Backend.EC2
    Hermes.Backend.ASG
    Hermes.Backend.S3
    Hermes.Backend.S3.Utils
    -- Monitoring stuff
    Hermes.Monitoring.Scaling.Types
    Hermes.Monitoring.Scaling.Reaper
    Hermes.Monitoring.Scaling.Logger
    -- Server stuff
    Hermes.Server.Extras
    Hermes.Server.Types
    Hermes.Server.API
    Hermes.Server.Strategy
    Hermes.Server.AMQP
    Hermes.Server.Transcoder.Priority
    Hermes.Server.Logo
    Hermes.Server.Simulation
    Hermes.Server.Simulation.Types
    Hermes.Server.Simulation.Report
    Hermes.Server.RuleEngine
    Hermes.Server.RuleEngine.Language.PrettyPrint
    -- Pan stuff
    System.Remote.Pan
    System.Remote.Pan.Tag
    System.Remote.Pan.Counter
    System.Remote.Pan.Agent
    Hermes.Perf.Efficiency
  other-modules:
    Paths_hermes
    Hermes.Server.RuleEngine.Types
    Hermes.Server.RuleEngine.Language.Parser

  build-depends:
      base                   >= 4.6 && < 5.0,
      binary                 ,
      cereal                 >= 0.4.0.0,
      cryptohash             >= 0.11.2,
      rncryptor              >= 0.0.2.1,
      amqp                   == 0.12,
      atlas                  == 1.2.7.0,
      ansi-terminal          >= 0.6,
      api-tools              >= 0.4,
      aeson                  < 0.9.0.0,
      annotated-wl-pprint    >= 0.5.3,
      async                  >= 2.0.1.5,
      auto-update            ,
      bytestring             >= 0.10.0.2,
      base64-bytestring      >= 1.0.0.1,
      blaze-html             >= 0.6.0.0,
      blaze-builder          ,
      case-insensitive       ,
      configurator           >= 0.2.0.2,
      containers             >= 0.5.0.0,
      deepseq                < 1.4,
      lens                   <  5.0,
      exceptions             >= 0.4,
      io-streams             >= 1.1.2.0,
      QuickCheck             >= 2.6,
      time                   >= 1.4.0,
      text                   >= 0.11.3.1,
      transformers-base      >= 0.4.1,
      http-conduit           >= 2.0.0.10,
      http-client            > 0.3,
      http-types             >= 0.8.3,
      ixset-typed            < 1.0,
      mtl                    >= 2.1,
      monad-loops            >= 0.3.3.0,
      resource-pool-catchio  >= 0.2.1.0,
      retry                  >= 0.5.1,
      safe                   >= 0.3.4,
      safecopy               < 0.9,
      snap-core              >= 0.9.7.2,
      snap                   >= 0.14.0.5,
      shelly                 == 1.5.4.1,
      string-conv            ,
      stm                    >= 2.4.2,
      threads-supervisor     >= 1.0.3.0,
      transformers           >= 0.3.0.0,
      parsec                 >= 3.1.5,
      process                >= 1.1.0.0,
      postgresql-simple      >= 0.4.6.0,
      generics-sop           ,
      postgresql-simple-sop  >= 0.1.0.2,
      random                 >= 1.0.1.1,
      raw-strings-qq         >= 1.0.2,
      optparse-applicative   >= 0.11.0.1 && < 0.13,
      old-locale             ,
      data-default           >= 0.5.3,
      text-format            >= 0.3.1.0,
      unix                   >= 2.6.0.1,
      unordered-containers   >= 0.2.5.0
  ghc-options:
      -funbox-strict-fields
      -Wall
      -fwarn-tabs

executable hermes
  if flag(threadscope)
    ghc-options: -threaded -eventlog
  if flag(prof)
    ghc-options: -fprof-auto -rtsopts -auto-all -caf-all
  if flag(library-only)
    buildable: False
  default-language:
    Haskell2010
  main-is:
      Main.hs
  hs-source-dirs:
     main
  build-depends:
      base             ,
      atlas            ,
      shelly           >= 1.5.0.1,
      data-default     >= 0.5.3,
      configurator     >= 0.2.0.2,
      hackage-uploader >= 0.2.0.10,
      containers       >= 0.5.0.0,
      transformers     >= 0.3.0.0,
      unix             >= 2.6.0.1,
      text             >= 0.11,
      hermes -any
  ghc-options:
      -Wall
      -threaded
      -O2
      -funbox-strict-fields
      "-with-rtsopts=-N"

executable hermes-docs
  if flag(library-only)
    buildable: False
  default-language:
    Haskell2010
  main-is:
    Main.hs
  hs-source-dirs:
    hermes-docs
  build-depends:
    base             ,
    hastache         ,
    shelly           ,
    configurator     ,
    unordered-containers,
    network-uri      ,
    string-conv      ,
    hermes           ,
    text
  ghc-options:
    -Wall
    -threaded
    -O2
    -funbox-strict-fields
    "-with-rtsopts=-N"

executable hermes-server
  main-is:
      Main.hs
  default-language:
    Haskell2010
  hs-source-dirs:
     server
  if flag(prof)
    ghc-options: -fprof-auto -rtsopts -auto-all -caf-all
  if flag(library-only)
    buildable: False

  other-modules:
      Handlers.Query
      Handlers.Metric
      Handlers.Stats
      Handlers.Simulation
      Handlers.RuleEngine
      Hermes.Server.Snaplets
      Hermes.Server.Transcoder
      Hermes.Server.Transcoder.Types
      Hermes.Monitoring
      Hermes.Monitoring.Memory
      Hermes.Monitoring.CloudWatch
      Hermes.Monitoring.Scaling
      System.Remote.Monitoring.DataDog
      Hermes.Perf.Roundtrip
      Snap.Snaplet.DataDog
      Application
      Handlers
      JSON
      Site
      Types
      Utils
  build-depends:
      base                 ,
      amqp                 ,
      atlas                ,
      async                >= 2.0.1.5,
      aeson                ,
      aeson-pretty         >=  0.6 && < 0.8,
      auto-update          ,
      configurator         >= 0.2.0.2,
      containers           >= 0.5.0.0,
      cereal               ,
      data-default         >= 0.5.3,
      lens                 ,
      exceptions           ,
      ekg                  >= 0.3.1.4,
      ekg-core             < 0.2,
      statsd-datadog       < 0.3,
      unordered-containers >= 0.2.5.0,
      hslogger             >= 1.2.6,
      http-client          ,
      shelly               >= 1.5.0.1,
      snap-core            >= 0.9.7.2,
      snap                 >= 0.14.0.5,
      snap-cors            >= 1.2.2,
      snap-server          >= 0.9.5.1,
      snap-core            ,
      snap-loader-static   >= 0.9.0,
      snaplet-postgresql-simple >= 0.6,
      stm                  >= 2.4.2,
      string-conv          ,
      postgresql-simple    ,
      resource-pool-catchio,
      http-conduit         >= 2.0.0.10,
      mtl                  >= 2.1.2,
      time                 >= 1.4.0.1,
      threads-supervisor   >= 1.0.3.0,
      transformers         >= 0.3.0.0,
      old-locale           ,
      bytestring           >= 0.10.2.0,
      text                 ,
      text-format          >= 0.3.1.0,
      hermes               >= 0.7.0.0,
      unix                 >= 2.7.0.0
  ghc-options:
      -threaded
      -O2
      "-with-rtsopts=-T -N -IO"
      -Wall
      -fwarn-tabs
      -funbox-strict-fields

executable hermes-progress
  default-language:
    Haskell2010
  main-is:
      hermes-progress.hs
  hs-source-dirs:
     main
  if flag(library-only)
    buildable: False

  build-depends:
      base,
      atlas,
      shelly,
      text,
      configurator,
      hermes -any,
      bytestring,
      data-default,
      io-streams
  ghc-options:
      -O2
      -threaded
      "-with-rtsopts=-N"
      -Wall
      -fwarn-tabs
      -funbox-strict-fields

executable hermes-tests
  default-language:
    Haskell2010
  if flag(library-only)
    buildable: False
  if flag(prof)
    ghc-options: -fprof-auto -rtsopts -auto-all -caf-all
  main-is:
      Main.hs
  other-modules:
      Hermes.Test.Extras
      Hermes.Test.Client.Tests
      Hermes.Test.Client.Types
      Hermes.Test.Server.Expectation
      Hermes.Test.Server.Request
      Hermes.Test.Server.StatsSpec
      Hermes.Test.Server.Tests
      Hermes.Test.RuleEngine.Tests
      Hermes.Test.Cluster.Tests
  hs-source-dirs:
      test server

  build-depends:
      async >= 2.0.1.5,
      amqp,
      base,
      bytestring,
      atlas           ,
      aeson,
      api-tools,
      cereal          ,
      configurator >= 0.2.0,
      containers   >= 0.5.0.0,
      http-conduit >= 2.0.0.0,
      http-types,
      lens,
      raw-strings-qq,
      case-insensitive,
      mtl          >= 2.1.2,
      configurator >= 0.2.0.2,
      data-default >= 0.5.3,
      postgresql-simple    ,
      shelly       >= 1.4.4.2,
      stm          >= 2.4.2,
      snap         ,
      QuickCheck   ,
      unordered-containers,
      statsd-datadog,
      ekg-core,
      transformers,
      random,
      threads-supervisor,
      tasty,
      tasty-hunit,
      tasty-hspec,
      tasty-quickcheck,
      tasty-rerun,
      text,
      time,
      hermes -any
  ghc-options:
      -threaded
      "-with-rtsopts=-N -K10K"

executable hermes-bench
  default-language:
    Haskell2010
  main-is:
      Main.hs
  if flag(bench)
    buildable: True
  else
    buildable: False

  other-modules:
      CLI
  hs-source-dirs:
     bench
  build-depends:
      base                      ,
      shelly                    ,
      transformers              ,
      text                      ,
      data-default              ,
      optparse-applicative      ,
      criterion      >= 1.0.0.0 ,
      hermes -any
  ghc-options:
      -Wall
      -threaded
      -O2
      -funbox-strict-fields
      "-with-rtsopts=-N"
